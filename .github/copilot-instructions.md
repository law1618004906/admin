# تعليمات GitHub Copilot لنظام إدارة البيانات الانتخابية

## نظرة عامة على المشروع
هذا نظام إدارة انتخابية عربي (RTL) مبني باستخدام Next.js 15، مصمم لتتبع القادة والأفراد في هيكل شجري متدرج. يشمل التطبيق لوحة تحكم كاملة لإدارة البيانات الانتخابية مع ميزات المصادقة والتفويض والتصور البياني.

## المكونات التقنية الرئيسية

### البنية التقنية
- **واجهة المستخدم**: Next.js 15 مع TypeScript و Tailwind CSS
- **الخلفية**: Next.js API routes مع تكامل خادم مخصص (Socket.IO)
- **قاعدة البيانات**: SQLite مع Prisma ORM
- **المصادقة**: تنفيذ JWT مخصص مع ملفات تعريف ارتباط HttpOnly
- **النشر**: حاويات Docker على Azure Web App

### نماذج البيانات الأساسية
- `leaders`: قادة الانتخابات مع معلومات مفصلة
- `persons`: الأفراد المرتبطون بالقادة، كل منهم مع معلومات التصويت
- `User`: مستخدمو الإدارة مع أذونات مستندة إلى الأدوار

### هيكل التطبيق
- `/src/app`: بنية Next.js app router مع المسارات المتداخلة
- `/src/components`: مكونات واجهة المستخدم القابلة لإعادة الاستخدام مع shadcn/ui
- `/src/lib`: الأدوات الأساسية للمصادقة وقاعدة البيانات والتسجيل
- `/src/hooks`: React hooks للمصادقة والأذونات

## سير العمل الرئيسي للمطورين

### التطوير المحلي
```bash
# تثبيت التبعيات
npm install

# إعداد قاعدة البيانات
npm run db:generate
npm run db:push

# تشغيل خادم التطوير
npm run dev

# بناء للإنتاج
npm run build
npm start
```

### عمليات قاعدة البيانات
```bash
# إنشاء عميل Prisma
npm run db:generate

# دفع تغييرات المخطط إلى قاعدة البيانات
npm run db:push

# تشغيل الترحيلات
npm run db:migrate

# إعادة تعيين قاعدة البيانات (كن حذرًا)
npm run db:reset

# تعبئة قاعدة البيانات بالبيانات
npx prisma db seed
```

### النشر
```bash
# النشر على Azure
./deploy-azure.sh

# التحقق من السجلات
docker-compose -f docker-compose.azure.yml logs -f

# نسخ قاعدة البيانات احتياطيًا
./backup-db.sh
```

## اتفاقيات خاصة بالمشروع

### تدفق المصادقة
- مصادقة JWT مخصصة مع ملفات تعريف ارتباط HttpOnly في `src/lib/auth.ts`
- المسارات المحمية باستخدام middleware `requireAuth` من `src/lib/middleware.ts`
- المصادقة من جانب العميل عبر hook `useAuth` في `src/hooks/use-auth.tsx`
- حساب المسؤول الرئيسي مضمن في الكود للوصول في حالات الطوارئ باسم المستخدم 'فقار' وكلمة المرور '123456'

### تصميم API
- تتبع مسارات API نمط `/api/{entity}/{action}`
- تستخدم جميع مسارات API الوسيط `requireAuth` للحماية
- بنية البيانات الشجرية لها تنسيق خاص مع علاقات الأصل-الفرع

### التطوير العربي أولاً
- تخطيط RTL في جميع أنحاء التطبيق
- جميع نصوص واجهة المستخدم والتوثيق باللغة العربية
- يتضمن الكود تعليقات باللغة العربية لسياق أفضل

### تنفيذ الهيكل الشجري
الميزة الأساسية هي عرض القادة والأشخاص بشكل هرمي شجري:
- `src/app/leaders-tree/page.tsx`: مكون واجهة المستخدم الشجرية التفاعلية
- `src/app/api/leaders-tree/route.ts`: API لبنية البيانات الشجرية
- يمكن للقادة أن يكون لديهم عدة أفراد، مع عدد أصوات مجمعة

## ملفات مهمة للفهم

- `server.ts`: إعداد الخادم المخصص مع تكامل Socket.IO
- `src/lib/auth.ts`: تنفيذ المصادقة
- `src/lib/middleware.ts`: وسيط حماية API
- `src/app/leaders-tree/page.tsx`: مكون التصور الشجري الرئيسي
- `prisma/schema.prisma`: تعريف مخطط قاعدة البيانات

## مشاكل شائعة
- استخدم دائمًا وسيط `requireAuth` لمسارات API لضمان الحماية
- تذكر أن SQLite لديها بعض القيود مقارنة بقواعد البيانات الأخرى
- بنية البيانات الشجرية تتطلب معالجة حذرة للحفاظ على العلاقات
- تعامل دائمًا مع اعتبارات RTL في مكونات واجهة المستخدم

## العمل مع الكود
1. ابدأ بفهم تدفق المصادقة والوسيط
2. استكشف تنفيذ الشجرة لفهم تصور البيانات الأساسي
3. استخدم مكونات واجهة المستخدم الحالية من shadcn/ui
4. اختبر ميزات المصادقة باستخدام حساب المسؤول المضمن
